/** 
 * microfilm.js
 * Browsable, filterable slides
 *
 * @author  Jawish Hameed <jaa@semicolon.com.mv>
 * @copyright   Semicolon Pvt Ltd <semicolon.com.mv>
 * @license MIT
 * @version 1.5 (21-04-2014)
 */
;!function(a){function l(b){g=[],j=b;for(var f=0,k=i.length;k>f;f++)i[f].hasClass(j)||"all"==j?(i[f].fadeIn(),g.push(i[f].attr("data-id")),a(c.settings.tocLinkSelector+'[data-target="'+i[f].attr("data-id")+'"]').removeClass("disabled")):(i[f].fadeOut(),a(c.settings.tocLinkSelector+'[data-target="'+i[f].attr("data-id")+'"]').addClass("disabled"));e=g[0],h=0,d.trigger("microfilm.seek")}function m(b,g){if(d.find(".mf-container").stop(),f>0){var j=i[f-1];j.toggleClass("mf-active"),j.removeClass("mf-large").find(".mf-full").hide().empty(),j.animate({width:c.settings.pageWidth},c.settings.pageCloseDuration,c.settings.pageCloseEasing,function(){j.find(".mf-preview").fadeIn()}),f=0}d.find(".mf-container").animate({left:-h*(c.settings.pageWidth+c.settings.pageSeparation)},c.settings.pageSeekDuration,c.settings.pageSeekEasing,function(){if(1==g){f=e;var b=i[e-1];b.find(".mf-preview").hide(),a.ajax({dataType:"html",beforeSend:function(){b.addClass("loading")},error:function(){b.removeClass("loading"),d.trigger("microfilm.seek")},success:function(d){a('<iframe scrolling="no" />').load(function(){var a=b.find(".mf-full iframe");a.contents().find("body").html(d),a.contents().find("body").css("margin",0,"width",k),a.css("height",a.contents().find("body").css("height"))}).appendTo(b.find(".mf-full")),b.addClass("mf-active").addClass("mf-large").animate({width:k},c.settings.pageOpenDuration,c.settings.pageOpenEasing,function(){b.removeClass("loading"),b.find(".mf-full").fadeIn()})},data:{xmlhttp:!0},url:b.find(c.settings.permaLinkSelector).attr("href")})}})}function n(){var d=a("body").innerWidth();k=c.settings.pageWidthLarge,k>d&&(k=d-2*c.settings.pageSeparation),d<=c.settings.pageWidthLarge?(a(c.settings.navNextSelector).addClass("mobile"),a(c.settings.navPreviousSelector).addClass("mobile")):(a(c.settings.navNextSelector).removeClass("mobile"),a(c.settings.navPreviousSelector).removeClass("mobile"))}function o(){h-1>=0&&h--,a(this).trigger("microfilm.seek")}function p(){g.length>h+1&&h++,d.trigger("microfilm.seek")}function q(){e=a(this).attr("data-target"),h=t(e),d.trigger("microfilm.seek")}function r(b){b.preventDefault(),e=a(this).attr("data-id"),h=t(e),d.trigger("microfilm.seek",[!0])}function s(){d.trigger("microfilm.seek")}function t(a){for(var b=0,c=g.length;c>=b;b++)if(g[b]==a)return b}function u(b){$elem=a(this).find("a"),$elem.css("top",b.pageY-$elem.height()/2)}function v(){a(this).find("a").animate({top:a(this).data("top")},200,"linear")}var c,d,k,b="microfilm",e=1,f=0,g=[],h=0,i=[],j="all",w={init:function(g){return c.settings=a.extend({},a.fn[b].defaults,g),this.each(function(){d=a(this);var b=1,g=null;location.hash&&(g=location.hash.replace("#/","")),isNaN(c.settings.pageWidthLarge)&&(c.settings.pageWidthLarge=d.innerWidth()),d.find(c.settings.pageSelector).each(function(){$elem=a(this),$elem.attr("data-id",b),0==f&&($elem.hasClass("mf-active")&&(e=f=b),null==g||$elem.attr("data-hash")!=g&&b!=g||(e=f=b)),i.push(a(this)),a(this).find(c.settings.permaLinkSelector).attr("data-id",b),b++}),displayPageCount=i.length,d.bind("microfilm.seek",{},m).bind("microfilm.show",{},r).bind("microfilm.next",{},p).bind("microfilm.previous",{},o),a(c.settings.permaLinkSelector).bind("click",{},r),a(c.settings.navPreviousSelector).bind("click",{},o).bind("mousemove",u).bind("mouseleave",v).data("top",a(c.settings.navPreviousSelector).find("a").css("top")),a(c.settings.navNextSelector).bind("click",{},p).bind("mousemove",u).bind("mouseleave",v).data("top",a(c.settings.navNextSelector).find("a").css("top")),a(c.settings.tocLinkSelector).bind("click",{},q),a(c.settings.closeLinkSelector).bind("click",{},s),a(window).bind("resize",{},n),c.settings.useMouseWheel&&a(window).bind("mousewheel",function(a,b){0==f&&(b>0?d.trigger("microfilm.next"):d.trigger("microfilm.previous"))}),a(window).bind("keydown",{},function(a){0==f&&(37==a.keyCode&&d.trigger("microfilm.previous"),39==a.keyCode&&d.trigger("microfilm.next"))}),a(c.settings.filterSelector).bind("click",function(){l(a(this).attr("data-category"))}),a(window).trigger("resize"),l(c.settings.initialFilter),d.trigger("microfilm.seek",[f>0])})},filter:function(a){l(a)},destroy:function(){return this.each(function(){})}};c=a.fn[b]=function(c){return w[c]?w[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?(a.error("Method "+c+" does not exist on jQuery."+b),void 0):w.init.apply(this,arguments)},a.fn[b].defaults={pageSelector:".mf-page",filterSelector:".mf-filters",initialFilter:"all",pageWidth:300,pageSeparation:10,pageWidthLarge:"auto",tocLinkSelector:".mf-toc",permaLinkSelector:".mf-permalink",pageCloseDuration:300,pageCloseEasing:"swing",pageSeekDuration:500,pageSeekEasing:"swing",pageOpenEasing:"swing",pageOpenDuration:300,navNextSelector:".mf-next",navPreviousSelector:".mf-previous",closeLinkSelector:".mf-close",useMouseWheel:!0},a.fn[b].settings={}}(jQuery);
